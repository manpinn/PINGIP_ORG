@using PINGIP_ORG.Common

@{
    ViewData["Title"] = "TraceRoute Ip-Addresses - Online-Tool";
}

<h1 class="display-4 text-center border-bottom">TraceRoute Ip-Addresses - Online-Tool</h1>
<br />
<p>Trace Route on specific IP-Address and get connection statistics with the Online-Tool on this Website.</p>

<div class="input-group mb-3">
    <div class="input-group-prepend">
        <span class="input-group-text bg-dark-subtle" id="basic-addon1">IPv4 / IPv6-Address</span>
    </div>
    <input id="input-ip" type="text" class="form-control" placeholder="Type in the IP-Address here" aria-label="IPv4/IPv6-Address" aria-describedby="basic-addon1">
</div>

<div class="d-grid gap-2 d-md-flex">
    <button id="btn-ping" class="btn btn-primary" type="button" style="width: 166px;">TRACEROUTE</button>
</div>

<div class="ml-spinner" style="display: none; align-items: center; margin-top:20px;">
    <div class="spinner-grow text-secondary" role="status"></div>
    <div style="margin-left: 10px;">Pinging ...</div>
</div>
<br />
<div id="ml-alert" class="alert alert-danger d-flex align-items-center d-none" role="alert">
</div>



<div id="cmd-window" class="cmd-window">
    <div class="cmd-header">
        <span class="cmd-title">TRACEROUTE RESULTS:</span>
        <button class="cmd-copy" onclick="copyToClipboard()">Copy</button>
    </div>
    <div>
        <span id="cmd-span" class="cmd-span"></span><br>
        <span class="cmd-cursor"></span>
    </div>
</div>
<br />
<div>
    <h2>Description</h2>
    <p>
        The online traceroute tool helps you trace the network path that packets take from our server to a specified IP-Address or domain. It reveals each "hop" along the way, typically a router or gateway, and shows how long each hop takes to respond.
    </p>
    <p>
        The online tool establishes a server-sided connection between our server and the specified IP-Address.
    </p>
    <p>
        <strong>Our Server's current IP-Address is @GlobalServerIPAddress.ServerIPAddress</strong>
    </p>
    <p>
        The Server is located in Germany.
    </p>

    <h2>Other Tools</h2>
    <div class="list-group" style="">
        @Html.ActionLink(" Ping IP - Ping a specific IP-Address", "Index", "Home", null, new { @class = "list-group-item list-group-item-action bi-play list-group-item-primary" })
        @Html.ActionLink(" Port Check - Check if ports are open on a specific IP-Address", "Index", "PortCheck", null, new { @class = "list-group-item list-group-item-action bi-play list-group-item-primary" })
        @Html.ActionLink(" My IP - Get your current IP-Address", "Index", "MyIP", null, new { @class = "list-group-item list-group-item-action bi-play list-group-item-primary" })
    </div>
    <br />

    <h2>🛰️ Traceroute Tool</h2>

    <p>
        This tool is especially useful for diagnosing network routing issues, identifying bottlenecks, or understanding how data travels across the internet to the target system.
    </p>

    <h3>📄 Example Output</h3>
    <div style="background-color: #f4f4f4; padding: 10px; border-radius: 5px; margin-bottom:1rem;">
        Tracing route to 8.8.8.8 over a maximum of 30 hops:<br />
        <br />
        1    <1 ms    <1 ms    <1 ms  192.168.1.1<br />
    2     5 ms     4 ms     5 ms  10.0.0.1<br />
    3    12 ms    11 ms    13 ms  core-router.provider.net [203.0.113.1]<br />
    4    18 ms    18 ms    17 ms  8.8.8.8<br />
    <br />
    Trace complete.
    </div>

    <h3>📌 Explanation of Parameters</h3>
    <ul>
        <li><strong>Hop Number:</strong> Shows the sequence of routers the packet travels through.</li>
        <li><strong>Round-Trip Times:</strong> Shows how long (in milliseconds) each router takes to respond.</li>
        <li><strong>IP / Hostname:</strong> Displays the IP-Address or domain name of the responding router.</li>
    </ul>

    <h3>🔍 What Traceroute Reveals</h3>
    <ul>
        <li><strong>Network Latency:</strong> Helps you spot where delays or timeouts happen in the path.</li>
        <li><strong>Routing Path:</strong> Useful for understanding which regions or networks your traffic passes through.</li>
        <li><strong>Failures or Timeouts:</strong> Asterisks (*) indicate a hop didn't respond, possibly due to firewall rules or timeouts.</li>
    </ul>

    <h4>🛠️ When to Use Traceroute</h4>
    <ul>
        <li>Troubleshooting slow connections</li>
        <li>Identifying where a connection is being blocked or delayed</li>
        <li>Understanding how your traffic is routed through the internet</li>
    </ul>

    <p>
        <strong>Note:</strong> Traceroute results may vary depending on firewall settings, network policies, or ISP routing.
    </p>
</div>


<script type="text/javascript">

        var buttonPing = document.getElementById('btn-ping');

        function ping() {
            //alert('Hello, World!');

            cmdSpan.innerHTML = '';

            document.getElementById('ml-alert').classList.add('d-none');

            document.querySelector('.ml-spinner').style.display = 'flex';

            let retVal = getValues();

            if (retVal == -1) {
                document.querySelector('.ml-spinner').style.display = 'none';

                const alert = document.getElementById('ml-alert');

                alert.classList.remove('d-none');

                alert.innerHTML = 'INSERT A VALID IP-ADDRESS';

                window.scrollTo({
                    top: 0,
                    behavior: 'smooth'
                });

                return;
            }

            let url = '/Home/AJAX/TraceRoute';
            let data = retVal;
            let serverData = {};

            fetch(url, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            })
                .then(response => response.text())
                .then(text => {
                    serverData = text;
                    console.log(serverData);

                    document.querySelector('.ml-spinner').style.display = 'none';

                    index = 0;

                    cmdSpan.innerHTML = '';

                    nextChar(text);
                })
                .catch((error) => {

                    document.querySelector('.ml-spinner').style.display = 'none';

                    const alert = document.getElementById('ml-alert');

                    alert.innerHTML = 'SERVER-ERROR';

                    alert.classList.add('d-none');

                    window.scrollTo({
                        top: 0,
                        behavior: 'smooth'
                    });

                    console.error('Error:', error);
                });


        }

        function isValidIPv4(ip) {
            const regex = /^(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/;
            return regex.test(ip);
        }

        function isValidIPv6(ip) {
            const regex = /([0-9a-fA-F]{1,4}:){7}([0-9a-fA-F]{1,4})|::|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:([0-9a-fA-F]{1,4})|([0-9a-fA-F]{1,4}:){1,5}:([0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}:([0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}:([0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}:([0-9a-fA-F]{1,4}){1,5}|([0-9a-fA-F]{1,4}:){1,1}:([0-9a-fA-F]{1,4}){1,6}$/i;
            return regex.test(ip);
        }



        function getValues() {

            const input = document.getElementById('input-ip');

            if(isValidIPv4(input.value) || isValidIPv6(input.value))
            {
                return input.value;
            }
            else
            {
                return -1;
            }
        }

        buttonPing.addEventListener('click', ping);

        function copyToClipboard() 
        {
            // Get the content from the cmd-span element
            const text = document.getElementById('cmd-span').innerText;

            // Create a temporary text area to copy the text
            const tempTextArea = document.createElement('textarea');
            tempTextArea.value = text;
            document.body.appendChild(tempTextArea);

            // Select the text in the text area
            tempTextArea.select();
            tempTextArea.setSelectionRange(0, 99999); // For mobile devices

            // Execute the copy command
            document.execCommand('copy');

            // Remove the temporary text area
            document.body.removeChild(tempTextArea);
        }

        let index = 0;

        var cmdSpan = document.getElementById('cmd-span');

        function nextChar(text)
        {
            if (index < text.length)
            {
                cmdSpan.innerHTML += text.charAt(index);

                index++;

                setTimeout(() => nextChar(text), 5);
            }
        }

</script>


@* <div class="list-group" style="">
    @Html.ActionLink(" Modules", "Index", "Module", null, new { @class = "list-group-item list-group-item-action bi-play" })
    @Html.ActionLink(" About", "About", "Home", null, new { @class = "list-group-item list-group-item-action bi-play" })
</div> *@